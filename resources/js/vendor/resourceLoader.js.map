{"version":3,"sources":["vendor/resourceLoader.js"],"names":["resourceLoader","options","$","jQuery","_loader","conditionsAllArray","_queue","_cache","_debug","debug","_defaults","container","readyEvent","extend","absolutePath","urlString","normalizedUrl","RegExp","test","indexOf","window","location","origin","paths","pathname","split","pop","join","normalizePath","path","resource","normalizedPath","charAt","base","substring","baseMap","console","log","getResources","each","this","resources","addPathToQueue","queueObject","type","uniquePath","dependsOn","dependingOnFiles","dependsOnPath","push","validateQueue","_tempQueue","tempLength","length","_loadedQueue","iterator","forEach","qO","index","splice","dependency","innerIndex","warn","loadResources","checkIfComplete","trigger","outerQueueObject","promise","Deferred","promiseName","innerQueueObject","dependencies","queueObjectInner","when","apply","done","cachePromise","ajax","url","dataType","cache","always","resolve","filter","item","fail","$link","rel","href","on","append","protocol","hostname","port","concat","$resources","find","addBack","obj","eval","attr"],"mappings":"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","file":"resourceLoader.js","sourcesContent":["/**\r\n * VI Resource Loader v1.2.0\r\n * For documentation see:\r\n * https://github.com/virtualidentityag/conditional-resource-loader\r\n */\r\n\r\nfunction resourceLoader(options) {\r\n\t'use strict';\r\n\r\n\tvar $ = jQuery;\r\n\tvar _loader = {\r\n\t\tconditionsAllArray: []\r\n\t};\r\n\tvar _queue = [];\r\n\tvar _cache = {};\r\n\tvar _debug = options.debug;\r\n\tvar _defaults = {\r\n\t\tcontainer: '', // css selector or jQuery element\r\n\t\treadyEvent: 'resourcesReady'\r\n\t};\r\n\t// options\r\n\t_loader.options = $.extend({}, _defaults, options);\r\n\r\n\r\n\t// creates absolute path from any given string\r\n\tvar absolutePath = function(urlString) {\r\n\t\tvar normalizedUrl;\r\n\t\tvar absoluteReg = new RegExp('^(?:[a-z]+:)?//', 'i');\r\n\r\n\t\tif (absoluteReg.test(urlString)) {\r\n\t\t\t// is absolute\r\n\t\t\tnormalizedUrl = urlString;\r\n\t\t} else {\r\n\t\t\tif (urlString.indexOf('/') === 0 && urlString.indexOf('//') !== 0) {\r\n\t\t\t\tnormalizedUrl = window.location.origin + urlString;\r\n\t\t\t} else {\r\n\t\t\t\tvar paths = window.location.pathname.split('/');\r\n\t\t\t\tpaths.pop();\r\n\t\t\t\tnormalizedUrl = window.location.origin + paths.join('/') + '/' + urlString;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn normalizedUrl;\r\n\t};\r\n\r\n\t/**\r\n\t * normalizes the incoming path (relative or absolute) to an absolute url\r\n\r\n\t * @param {string} path\r\n\t * @param {object} resource\r\n\t * @returns {string} normalizedPath\r\n\t */\r\n\tvar normalizePath = function (path, resource) {\r\n\t\tvar normalizedPath;\r\n\t\tvar pathIsRelative = path.indexOf('http://') === -1 &&\r\n\t\t\tpath.indexOf('https://') === -1 &&\r\n\t\t\tpath.charAt(0) !== '/';\r\n\r\n\t\t//resolve relative paths\r\n\t\tif (pathIsRelative) {\r\n\t\t\tif (resource.base) {\r\n\t\t\t\tif (resource.base.substring(0, 2) === '##') {\r\n\t\t\t\t\tresource.base = options.baseMap[resource.base];\r\n\t\t\t\t}\r\n\t\t\t\tpath = resource.base + path;\r\n\t\t\t} else if (options && options.base) {\r\n\t\t\t\tpath = options.base + path;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// create unique absolute path\r\n\t\tnormalizedPath = absolutePath(path);\r\n\r\n\t\tif (_debug) {\r\n\t\t\tconsole.log('inputPath: ' + path);\r\n\t\t\tconsole.log('normalizedPath: ' + normalizedPath);\r\n\t\t\tconsole.log('------');\r\n\t\t}\r\n\r\n\t\treturn normalizedPath;\r\n\t};\r\n\r\n\t/**\r\n\t * gets all needed resources on one page and adds them to the download queue\r\n\t */\r\n\tvar getResources = function () {\r\n\t\t$.each(_loader.conditionsAllArray, function () {\r\n\t\t\t$.each(this.resources, function () {\r\n\t\t\t\tvar resource = this;\r\n\t\t\t\tvar test = resource.test ? resource.test() : true;\r\n\r\n\t\t\t\tif (test) {\r\n\t\t\t\t\t$.each(resource.paths, function () {\r\n\t\t\t\t\t\taddPathToQueue(this, resource);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tvar addPathToQueue = function(path, resource) {\r\n\t\tvar queueObject = {};\r\n\r\n\t\tqueueObject.type = path.indexOf('.css') > -1 ? 'css' : 'js';\r\n\t\tqueueObject.uniquePath = normalizePath(path, resource);\r\n\r\n\t\t// check depending on files\r\n\t\tif (resource.dependsOn) {\r\n\t\t\tqueueObject.dependingOnFiles = [];\r\n\r\n\t\t\t$.each(resource.dependsOn, function () {\r\n\t\t\t\tvar dependsOnPath = normalizePath(this, resource);\r\n\t\t\t\tqueueObject.dependingOnFiles.push(dependsOnPath);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// add object to queue\r\n\t\t_queue.push(queueObject);\r\n\t};\r\n\r\n\t/**\r\n\t * Validates all files and dependencies in the queue and checks if there are any errors\r\n\t */\r\n\tvar validateQueue = function () {\r\n\t\tvar _tempQueue = $.extend(true, [], _queue);\r\n\t\tvar tempLength = _tempQueue.length;\r\n\t\tvar _loadedQueue = [];\r\n\r\n\t\tfor (var iterator = 0; iterator < tempLength; iterator++) {\r\n\t\t\t_tempQueue.forEach(function (qO, index) {\r\n\t\t\t\tif (!qO.dependingOnFiles || qO.dependingOnFiles.length === 0) {\r\n\t\t\t\t\t_loadedQueue.push(qO.uniquePath);\r\n\t\t\t\t\t_tempQueue.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_tempQueue.forEach(function (qO, index) {\r\n\t\t\t\tif (_loadedQueue.indexOf(qO.uniquePath) !== -1) {\r\n\t\t\t\t\t_tempQueue.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_tempQueue.forEach(function (qO, index) {\r\n\t\t\t\tif (qO.dependingOnFiles) {\r\n\t\t\t\t\tqO.dependingOnFiles.forEach(function (dependency, innerIndex) {\r\n\t\t\t\t\t\tif (_loadedQueue.indexOf(dependency) !== -1) {\r\n\t\t\t\t\t\t\tqO.dependingOnFiles.splice(innerIndex, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// check if any unresolvable dependencies are set\r\n\t\tif (_tempQueue.length > 0) {\r\n\t\t\t_tempQueue.forEach(function (qO) {\r\n\t\t\t\tconsole.warn('Error: Unresolved dependency for ' + qO.uniquePath + ' detected. Dependencies: ' + qO.dependingOnFiles);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * load all the resources in queue\r\n\t */\r\n\tvar loadResources = function () {\r\n\t\t// if queue is empty, trigger ready\r\n\t\tvar checkIfComplete = function () {\r\n\t\t\tif (_debug) {\r\n\t\t\t\tconsole.log('Remaining queue: ', _queue);\r\n\t\t\t}\r\n\r\n\t\t\tif (_queue.length === 0) {\r\n\t\t\t\t$(window).trigger(_loader.options.readyEvent);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (_queue.length === 0) {\r\n\t\t\t$(window).trigger(_loader.options.readyEvent);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// create promise for each unique queue object (path as unique id)\r\n\t\t_queue.forEach(function (outerQueueObject, index) {\r\n\t\t\touterQueueObject.promise = $.Deferred();\r\n\t\t\tif (_debug) {\r\n\t\t\t\touterQueueObject.promiseName = 'promise' + index;\r\n\t\t\t}\r\n\r\n\t\t\t_queue.forEach(function (innerQueueObject) {\r\n\t\t\t\tif (innerQueueObject.uniquePath === outerQueueObject.uniquePath) {\r\n\t\t\t\t\tinnerQueueObject.promise = outerQueueObject.promise;\r\n\t\t\t\t\tif (_debug) {\r\n\t\t\t\t\t\tinnerQueueObject.promiseName = outerQueueObject.promiseName;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// add dependencies\r\n\t\t_queue.forEach(function (queueObject) {\r\n\t\t\tqueueObject.dependencies = [];\r\n\t\t\tif (queueObject.dependingOnFiles) {\r\n\t\t\t\tqueueObject.dependingOnFiles.forEach(function (dependency) {\r\n\t\t\t\t\t_queue.forEach(function (queueObjectInner) {\r\n\t\t\t\t\t\tif (queueObjectInner.uniquePath === dependency) {\r\n\t\t\t\t\t\t\t(queueObject.dependencies.push(queueObjectInner.promise));\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// execute dependencies\r\n\t\t_queue.forEach(function (queueObject) {\r\n\r\n\t\t\t$.when.apply($, queueObject.dependencies).done(function () {\r\n\t\t\t\tvar cachePromise;\r\n\r\n\t\t\t\t// not already loading\r\n\t\t\t\tif (typeof _cache[queueObject.uniquePath] === 'undefined') {\r\n\t\t\t\t\t// load js file\r\n\t\t\t\t\tif (queueObject.type === 'js') {\r\n\t\t\t\t\t\tcachePromise = $.ajax({\r\n\t\t\t\t\t\t\turl: queueObject.uniquePath,\r\n\t\t\t\t\t\t\tdataType: 'script',\r\n\t\t\t\t\t\t\tcache: true\r\n\t\t\t\t\t\t}).always(function () {\r\n\t\t\t\t\t\t\tqueueObject.promise.resolve();\r\n\t\t\t\t\t\t\t_queue = _queue.filter(function (item) {\r\n\t\t\t\t\t\t\t\treturn item.uniquePath !== queueObject.uniquePath;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (_debug) {\r\n\t\t\t\t\t\t\t\tconsole.log('Promise for ' + queueObject.uniquePath + ' resolved.');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcheckIfComplete();\r\n\t\t\t\t\t\t}).fail(function () {\r\n\t\t\t\t\t\t\tconsole.warn('Error while loading: ' + queueObject.uniquePath);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// load css file\r\n\t\t\t\t\tif (queueObject.type === 'css') {\r\n\t\t\t\t\t\tvar $link = $('<link/>', {\r\n\t\t\t\t\t\t\trel: 'stylesheet',\r\n\t\t\t\t\t\t\ttype: 'text/css',\r\n\t\t\t\t\t\t\thref: queueObject.uniquePath\r\n\t\t\t\t\t\t}).on('load', function () {\r\n\t\t\t\t\t\t\tqueueObject.promise.resolve();\r\n\t\t\t\t\t\t\t_queue = _queue.filter(function (item) {\r\n\t\t\t\t\t\t\t\treturn item.uniquePath !== queueObject.uniquePath;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (_debug) {\r\n\t\t\t\t\t\t\t\tconsole.log('Promise for ' + queueObject.uniquePath + ' resolved.');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcheckIfComplete();\r\n\t\t\t\t\t\t}).on('error', function () {\r\n\t\t\t\t\t\t\tconsole.warn('Error while loading: ' + queueObject.uniquePath);\r\n\t\t\t\t\t\t\tqueueObject.promise.resolve();\r\n\t\t\t\t\t\t\t_queue = _queue.filter(function (item) {\r\n\t\t\t\t\t\t\t\treturn item.uniquePath !== queueObject.uniquePath;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (_debug) {\r\n\t\t\t\t\t\t\t\tconsole.log('Promise for ' + queueObject.uniquePath + ' resolved.');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcheckIfComplete();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t$('head').append($link);\r\n\t\t\t\t\t\tcachePromise = $.Deferred().resolve();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_cache[queueObject.uniquePath] = cachePromise;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tif (!window.location.origin) {\r\n\t\twindow.location.origin = window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port: '');\r\n\t}\r\n\r\n\tif (options && options.resources) {\r\n\t\t_loader.conditionsAllArray = _loader.conditionsAllArray.concat(options.resources);\r\n\t}  else {\r\n\t\tvar $resources = (_loader.options.container != '') ? $(_loader.options.container).find('[data-resources]').addBack('[data-resources]') : $('[data-resources]');\r\n\r\n\t\t$resources.each(function () {\r\n\t\t\tvar obj = {};\r\n\t\t\tobj.resources = eval($(this).attr('data-resources'));\r\n\t\t\t_loader.conditionsAllArray.push(obj);\r\n\t\t});\r\n\t}\r\n\r\n\tif (_loader.conditionsAllArray.length > 0) {\r\n\t\tgetResources();\r\n\t\tvalidateQueue();\r\n\t\tloadResources();\r\n\t} else {\r\n\t\t$(window).trigger(_loader.options.readyEvent);\r\n\t}\r\n}\r\n"]}