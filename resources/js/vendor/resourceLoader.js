function resourceLoader(options){"use strict";var $=jQuery,_loader={conditionsAllArray:[]},_queue=[],_cache={},_debug=options.debug,_defaults={container:"",readyEvent:"resourcesReady"};_loader.options=$.extend({},_defaults,options);var absolutePath=function(e){var n;if(new RegExp("^(?:[a-z]+:)?//","i").test(e))n=e;else if(0===e.indexOf("/")&&0!==e.indexOf("//"))n=window.location.origin+e;else{var o=window.location.pathname.split("/");o.pop(),n=window.location.origin+o.join("/")+"/"+e}return n},normalizePath=function(e,n){var o;return-1===e.indexOf("http://")&&-1===e.indexOf("https://")&&"/"!==e.charAt(0)&&(n.base?("##"===n.base.substring(0,2)&&(n.base=options.baseMap[n.base]),e=n.base+e):options&&options.base&&(e=options.base+e)),o=absolutePath(e),_debug&&(console.log("inputPath: "+e),console.log("normalizedPath: "+o),console.log("------")),o},getResources=function(){$.each(_loader.conditionsAllArray,function(){$.each(this.resources,function(){var e=this;(!e.test||e.test())&&$.each(e.paths,function(){addPathToQueue(this,e)})})})},addPathToQueue=function(e,n){var o={};o.type=e.indexOf(".css")>-1?"css":"js",o.uniquePath=normalizePath(e,n),n.dependsOn&&(o.dependingOnFiles=[],$.each(n.dependsOn,function(){var e=normalizePath(this,n);o.dependingOnFiles.push(e)})),_queue.push(o)},validateQueue=function(){for(var e=$.extend(!0,[],_queue),n=e.length,o=[],i=0;i<n;i++)e.forEach(function(n,i){n.dependingOnFiles&&0!==n.dependingOnFiles.length||(o.push(n.uniquePath),e.splice(i,1))}),e.forEach(function(n,i){-1!==o.indexOf(n.uniquePath)&&e.splice(i,1)}),e.forEach(function(e,n){e.dependingOnFiles&&e.dependingOnFiles.forEach(function(n,i){-1!==o.indexOf(n)&&e.dependingOnFiles.splice(i,1)})});e.length>0&&e.forEach(function(e){console.warn("Error: Unresolved dependency for "+e.uniquePath+" detected. Dependencies: "+e.dependingOnFiles)})},loadResources=function(){var e=function(){_debug&&console.log("Remaining queue: ",_queue),0===_queue.length&&$(window).trigger(_loader.options.readyEvent)};0!==_queue.length?(_queue.forEach(function(e,n){e.promise=$.Deferred(),_debug&&(e.promiseName="promise"+n),_queue.forEach(function(n){n.uniquePath===e.uniquePath&&(n.promise=e.promise,_debug&&(n.promiseName=e.promiseName))})}),_queue.forEach(function(e){e.dependencies=[],e.dependingOnFiles&&e.dependingOnFiles.forEach(function(n){_queue.forEach(function(o){o.uniquePath!==n||e.dependencies.push(o.promise)})})}),_queue.forEach(function(n){$.when.apply($,n.dependencies).done(function(){var o;if(void 0===_cache[n.uniquePath]){if("js"===n.type&&(o=$.ajax({url:n.uniquePath,dataType:"script",cache:!0}).always(function(){n.promise.resolve(),_queue=_queue.filter(function(e){return e.uniquePath!==n.uniquePath}),_debug&&console.log("Promise for "+n.uniquePath+" resolved."),e()}).fail(function(){console.warn("Error while loading: "+n.uniquePath)})),"css"===n.type){var i=$("<link/>",{rel:"stylesheet",type:"text/css",href:n.uniquePath}).on("load",function(){n.promise.resolve(),_queue=_queue.filter(function(e){return e.uniquePath!==n.uniquePath}),_debug&&console.log("Promise for "+n.uniquePath+" resolved."),e()}).on("error",function(){console.warn("Error while loading: "+n.uniquePath),n.promise.resolve(),_queue=_queue.filter(function(e){return e.uniquePath!==n.uniquePath}),_debug&&console.log("Promise for "+n.uniquePath+" resolved."),e()});$("head").append(i),o=$.Deferred().resolve()}_cache[n.uniquePath]=o}})})):$(window).trigger(_loader.options.readyEvent)};if(window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),options&&options.resources)_loader.conditionsAllArray=_loader.conditionsAllArray.concat(options.resources);else{var $resources=""!=_loader.options.container?$(_loader.options.container).find("[data-resources]").addBack("[data-resources]"):$("[data-resources]");$resources.each(function(){var obj={};obj.resources=eval($(this).attr("data-resources")),_loader.conditionsAllArray.push(obj)})}_loader.conditionsAllArray.length>0?(getResources(),validateQueue(),loadResources()):$(window).trigger(_loader.options.readyEvent)}
//# sourceMappingURL=resourceLoader.js.map
